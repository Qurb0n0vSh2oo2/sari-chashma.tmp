window.mailRuToolbarDriver=(function(k,y){var j=false;var e,r,q,a,f="portal-headline__projects_open",s,C,z,p={mail_cnt:"g_mail_events",my_cnt:"g_my_events",games_cnt:"g_games_events"};function A(d){d.stopPropagation?d.stopPropagation():d.cancelBubble=true;d.preventDefault?d.preventDefault():d.returnValue=false;}function t(d,w,l,m){if(w.addEventListener){w[d?"addEventListener":"removeEventListener"](l,m,false);}else{if(w.attachEvent){w[d?"attachEvent":"detachEvent"]("on"+l,m);}}}function b(l,d){return l.className.match(new RegExp("(\\s|^)"+d+"(\\s|$)"));}function n(l,d){if(!b(l,d)){l.className+=" "+d;}}function o(m,d){if(b(m,d)){var l=new RegExp("(\\s+|^)"+d+"(\\s+|$)");m.className=m.className.replace(l," ");}}function x(d){clearTimeout(C);C=null;A(d);b(a,f)?v():i();}function i(){e=y.getElementById("topPanel");t(1,y,"click",v);if(e){e.style.zIndex=5000;}n(a,f);}function v(){t(0,y,"click",v);if(e){e.style.zIndex=2501;}o(a,f);}function c(){clearTimeout(C);C=null;}function g(){clearTimeout(C);C=setTimeout(v,4000);}function h(w,D,m){s=null;var l=y.getElementsByTagName("head")[0];if(z){l.removeChild(z);}var d=k.top.MRG_toolbarUpdateTimeout;if(d>0&&y.getElementById("mailRuToolbar")){z=y.createElement("script");z.type="text/javascript";z.src="http://swa.mail.ru/cgi-bin/counters?JSONP_call=MRG_updateToolbar&gamescnt=1&rnd="+Math.random();l.appendChild(z);if(!m){s=setTimeout(h,d);}}else{k.top.MRG_updateToolbar=null;}}var B=function(){if(j){return;}j=true;r=y.getElementById("portal-headline__menulink");q=y.getElementById("portal-headline__menu");a=y.getElementById("portal-headline__box");if(r==null||q==null||a==null){return;}t(1,r,"click",x);t(1,r,"mouseout",g);t(1,r,"mouseover",c);t(1,q,"mouseout",g);t(1,q,"mouseover",c);if(!k.top.MRG_updateToolbar){k.top.MRG_updateToolbar=function(d){var w="portal-headline__link_ext";for(var l in p){var m=y.getElementById(p[l]);if(!m){continue;}if(d&&d.status==="ok"&&d.data&&(d.data[l]>0||d.data[l]==="99+")){n(m.parentNode,w);m.innerHTML=d.data[l];}else{o(m.parentNode,w);}}};h();}else{h(0,0,true);}};var u=function(){j=false;if(C!=null){clearTimeout(C);C=null;}if(s!=null){clearTimeout(s);s=null;}};setTimeout(B,1000);return{bind:B,unbind:u};})(window,document);